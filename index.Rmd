---
title: J-IDEA COVID-19 excess deaths tracker for England and Wales
fig_caption: yes
fontsize: 11pt
output:
  html_document:
    df_print: paged
    css: styles.css
    includes:
      before_body: "header.html"
      after_body: "footer.html"
      in_header: ganalytics.html
keep_tex: yes
geometry: margin=1in
subtitle: Weekly estimates of expected deaths and excess non-COVID-19 deaths during the pandemic in England and Wales
---

```{r, echo=FALSE, warning=F, message=FALSE, include=FALSE}
library(ggplot2)
library(readxl)
library(stringr)
library(gdata)
library(dplyr)
library(tidyverse)
library(gridExtra)
library(stargazer)
library(knitr)
library(kableExtra)
library(lemon)
library(ggpubr)

s<-function(pos,data){
  data[pos[1],1]<-paste0("All ",data[pos[1],1])
  data[pos[2],1]<-paste0("Male ",data[pos[2],1])
  data[pos[3],1]<-paste0("Female ",data[pos[3],1])
  return (data)
}

extract.week<-function(var){
  forecasts.week<-read.csv(paste0("./forecasts/",var,".csv"),stringsAsFactors = F)
  forecasts.week$Week.ended<-as.Date(forecasts.week$Week.ended)
  forecasts.week<-forecasts.week[,c("Week.ended", "signal","fit","upr","lwr")]
  data<-read.csv("./CleanedData.csv",stringsAsFactors = F)
  data$Week.ended<-as.Date(data$Week.ended)
  #if (var=="England"){
  #  data$England<-rowSums(data[,c("North.East","North.West","Yorkshire.and.The.Humber","East.Midlands",
  #                                "West.Midlands", "East","London","South.East",
  #                                "South.West")])
  #}
  temp<-data[,c("Week.ended",var)]
  forecasts.week<-merge(temp,  forecasts.week,by='Week.ended',all.y=T)
  forecasts.week<-forecasts.week[1:nrow(temp),]
  temp<-NULL
  
  covid<-read.csv("./Covid_Registration.csv")
  covid$Week.ended<-as.Date(covid$Week.ended, origin = "1899-12-30")
  covid<-dplyr::rename(covid, Total.deaths.all.ages = Total.COVID.19.deaths.all.ages)
  data$respiratory<-NULL
  covid$England<-rowSums(covid[,c("North.East","North.West","Yorkshire.and.The.Humber","East.Midlands",
                                  "West.Midlands", "East","London","South.East",
                                  "South.West")])
  temp<-covid[,c("Week.ended",var),]
  colnames(temp)<-c("Week.ended","Covid")
  forecasts.week<-merge(temp,  forecasts.week, by='Week.ended',all.y=T)
  forecasts.week <- dplyr::rename(forecasts.week, Deaths = var)
  forecasts.week$region<-var
  return(forecasts.week)
}

extract.cumulative<-function(var){
  forecasts.c<-read.csv(paste0("./forecasts/",var,"_cumulative.csv"),stringsAsFactors = F)
  forecasts.c$Week.ended<-as.Date(forecasts.c$Week.ended)
  forecasts.c<-forecasts.c[,c("Week.ended","X2.5.","X50.","X97.5.","fit")]
  colnames(forecasts.c)<-c("Week.ended","2.5%","50%","97.5%","fit")
  #forecasts.c<-forecasts.c[forecasts.c$Week.ended>=as.Date("2020-03-01"), ]
  
  data<-read.csv("./CleanedData.csv",stringsAsFactors = F)
  data$Week.ended<-as.Date(data$Week.ended)
  #if (var=="England"){
  #  data$England<-rowSums(data[,c("North.East","North.West","Yorkshire.and.The.Humber","East.Midlands",
  #                                "West.Midlands", "East","London","South.East",
  #                                "South.West")])
  #}
  temp<-data[data$Week.ended>=as.Date("2020-03-01"),c("Week.ended",var)]
  
  temp[,var]<-cumsum(temp[,var])
  
  temp$Week.ended<-as.Date(temp$Week.ended)
  forecasts.c<-merge(temp,  forecasts.c, by='Week.ended',all.x=T)
  forecasts.c<-forecasts.c[1:nrow(temp),]
  temp<-NULL
  forecasts.c$signal<-NULL
  
  
  covid<-read.csv("./Covid_Registration.csv")
  covid$Week.ended<-as.Date(covid$Week.ended, origin = "1899-12-30")
  covid<-dplyr::rename(covid, Total.deaths..all.ages = Deaths.involving.COVID.19..all.ages1)
  data$respiratory<-NULL
  covid$England<-rowSums(covid[,c("North.East","North.West","Yorkshire.and.The.Humber","East.Midlands",
                                  "West.Midlands", "East","London","South.East",
                                  "South.West")])
  temp<-covid[,c("Week.ended",var),]
  
  colnames(temp)<-c("Week.ended","Covid")
  temp$Covid<-cumsum(temp$Covid)
  temp$Week.ended<-as.Date(temp$Week.ended)
  forecasts.c<-merge(temp,  forecasts.c, by='Week.ended',all.y=T)
  forecasts.c <- dplyr::rename(forecasts.c, Deaths = var)
  forecasts.c$region<-var
  return(forecasts.c)
}

producePlot<-function(name){
  name.data = extract.week(name)
  name.data<-name.data[name.data$Week.ended>=as.Date("2020-03-01"),]
  name.data$signal<-NULL
  name.data$region<-NULL
  name.data$excess.covid<-name.data[,"Deaths"] - name.data$Covid
  name.data$Covid<-NULL
  name.data<-reshape2::melt(name.data, id.var = c("Week.ended", "lwr", "upr"))
  
  name.data$variable<-factor(name.data$variable, levels=c("fit", "Deaths", "excess.covid"),
                             labels=c(paste("Forecasted 06/03 -", format(max(name.data$Week.ended),
                                                                         "%d/%m")),
                                      "Observed all-cause",
                                      "Registered non-COVID deaths"))
  
  p.name<-ggplot(name.data, aes(x=Week.ended, y=value,colour=variable))+ 
    geom_ribbon(aes(ymin=lwr, ymax=upr), colour=NA, fill="gray70", alpha=0.5)+
    geom_line()+
    scale_x_date(breaks=unique(name.data$Week.ended)[c(TRUE,FALSE)], date_labels="%d/%m")+
    theme_bw(base_size=12, base_family="Helvetica")+theme_minimal()+
    theme(axis.text.x = element_text(angle=45, hjust=1))+
    scale_colour_manual(values=c("Black", "Red", "Purple"))+
    labs(colour="Deaths", y="Deaths", x="")
  
  return(p.name)
}
dat_temp <- Sys.Date() #-2
current_date = strsplit(as.character(dat_temp), '-')[[1]]
current_year = current_date[1]
current_week = as.numeric(strftime(c(dat_temp), format = "%V")) - 2
filename = sprintf("publishedweek%s%s.xlsx", current_week, current_year)
ONS_url = sprintf("https://www.ons.gov.uk/file?uri=/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/datasets/weeklyprovisionalfiguresondeathsregisteredinenglandandwales/%s/%s", current_year, filename)

download.file(ONS_url, destfile=paste0("./data_dashboard/", "newest_results.xlsx"), quiet=T)
data<-read_xlsx("./data_dashboard/newest_results.xlsx", sheet='Weekly figures 2020', col_names = FALSE)

data<-data[complete.cases(data[,3:8]),]
data[is.na(data[,1]),1]<-data[is.na(data[,1]),2]
k<-(1:nrow(data))[data$...1=="E12000001"]
data[(k:(k+9)),1]<-data[(k:(k+9)),2]
data[,2]<-NULL


r<-c("<1", "1-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59",                                                                                
     "60-64","65-69","70-74", "75-79", "80-84", "85-89","90+"   )

for (n in r){
  pos<-which(data[,1] == n)
  data<-s(pos,data)
}
data[data==":"]<-NA
data<-as.data.frame(t(data))
data<-data[complete.cases(data),]

write.table(data, file=paste0("./DataCleaned/mortality2020.csv"), row.names=FALSE, col.names=FALSE, sep=",")
data<-read.csv("./DataCleaned/mortality2020.csv",stringsAsFactors = FALSE)

df <- data %>% mutate(
  All.Under.1.year=All..1,
  Male.Under.1.year=Male..1,
  Female.Under.1.year=Female..1,
  All.01.14=All.1.4+All.5.9+All.10.14,
  Male.01.14=Male.1.4+Male.5.9+Male.10.14,
  Female.01.14=Female.1.4+Female.5.9+Female.10.14,
  All.15.44=All.15.19+All.20.24+All.25.29+All.30.34+All.35.39+All.40.44,                                                                            	                                                   
  Male.15.44=Male.15.19+Male.20.24+Male.25.29+Male.30.34+Male.35.39+Male.40.44,                                                                          	                                                   
  Female.15.44=Female.15.19+Female.20.24+Female.25.29+Female.30.34+Female.35.39+Female.40.44,
  All.45.64=All.45.49+All.50.54+All.55.59+All.60.64,
  Male.45.64=Male.45.49+Male.50.54+Male.55.59+Male.60.64,
  Female.45.64=Female.45.49+Female.50.54+Female.55.59+Female.60.64,
  All.65.74=All.65.69+All.70.74,
  Male.65.74=Male.65.69+Male.70.74,
  Female.65.74=Female.65.69+Female.70.74,
  All.75.84=All.75.79+All.80.84,
  Male.75.84=Male.75.79+Male.80.84,
  Female.75.84=Female.75.79+Female.80.84,
  All.85.=All.85.89+All.90.,
  Male.85.=Male.85.89+Male.90.,
  Female.85.=Female.85.89+Female.90.,
  North.East=North.East,
  North.West=North.West,
  Yorkshire.and.The.Humber=Yorkshire.and.The.Humber,
  East.Midlands=East.Midlands,
  West.Midlands=West.Midlands,
  East=East,
  London=London,
  South.East=South.East,
  South.West=South.West,
  Wales=Wales,
  England=North.East+North.West+Yorkshire.and.The.Humber+East.Midlands+West.Midlands+East+London+South.East+South.West,
  Total.deaths.all.ages=Total.deaths..all.ages,
  Week.number=Week.number,
  Week.ended=Week.ended,
  Average.5.years.England.and.Wales=week.over.the.previous.5.years.1..England.and.Wales.,
  Average.5.years.England=week.over.the.previous.5.years.1..England.,
  Average.5.years.Wales=week.over.the.previous.5.years.1..Wales.,
  Respiratory.deaths=Deaths.where.the.underlying.cause.was.respiratory.disease..ICD.10.J00.J99.
)
write.csv(df, file="./DataCleaned/mortality2020.csv", row.names=FALSE)

data<-read.csv("./DataCleaned/mortality2010.csv",stringsAsFactors = FALSE)
files<-list.files("./DataCleaned")
files<-files[files!="./DataCleaned/mortality2010.csv"]
for (file in files){
  temp<-read.csv(paste0("./DataCleaned/",file),stringsAsFactors = FALSE)
  data<-bind_rows(data, temp)
}
#data$Week.ended<-abs(data$Week.ended)
data$Week.ended<-as.Date(data$Week.ended, origin = "1899-12-30")
write.csv(data,"./CleanedData.csv")

###########################################

data<-read_xlsx('./data_dashboard/newest_results.xlsx',sheet='Covid-19 - Weekly registrations' ,col_names = FALSE,range='A5:BC86')
data<-data[complete.cases(data[,3:8]),]
data[is.na(data[,1]),1]<-data[is.na(data[,1]),2]
k<-(1:nrow(data))[data$...1=="E12000001"]
data[(k:(k+9)),1]<-data[(k:(k+9)),2]
data[,2]<-NULL


r<-c("<1", "1-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59",                                                                                
     "60-64","65-69","70-74", "75-79", "80-84", "85-89","90+"   )

for (n in r){
  pos<-which(data[,1] == n)
  data<-s(pos,data)
}
data[data==":"]<-NA
data<-as.data.frame(t(data))
data<-data[complete.cases(data),]

write.table(data, file=paste0("./Covid_Registration.csv"), row.names=FALSE, col.names=FALSE, sep=",")
data<-read.csv("./Covid_Registration.csv",stringsAsFactors = FALSE)


df <- data %>% mutate(
  All.Under.1.year= All..1,
  Male.Under.1.year=Male..1,
  Female.Under.1.year=Female..1,
  All.01.14=All.1.4+All.5.9+All.10.14,
  Male.01.14=Male.1.4+Male.5.9+Male.10.14,
  Female.01.14=Female.1.4+Female.5.9+Female.10.14,
  All.15.44=All.15.19+All.20.24+All.25.29+All.30.34+All.35.39+All.40.44,                                                                            	                                                   
  Male.15.44=Male.15.19+Male.20.24+Male.25.29+Male.30.34+Male.35.39+Male.40.44,                                                                          	                                           
  Female.15.44=Female.15.19+Female.20.24+Female.25.29+Female.30.34+Female.35.39+Female.40.44,
  All.45.64=All.45.49+All.50.54+All.55.59+All.60.64,
  Male.45.64=Male.45.49+Male.50.54+Male.55.59+Male.60.64,
  Female.45.64=Female.45.49+Female.50.54+Female.55.59+Female.60.64,
  All.65.74=All.65.69+All.70.74,
  Male.65.74=Male.65.69+Male.70.74,
  Female.65.74=Female.65.69+Female.70.74,
  All.75.84=All.75.79+All.80.84,
  Male.75.84=Male.75.79+Male.80.84,
  Female.75.84=Female.75.79+Female.80.84,
  All.85.=All.85.89+All.90.,
  Male.85.=Male.85.89+Male.90.,
  Female.85.=Female.85.89+Female.90.,
  North.East=North.East,
  North.West=North.West,
  Yorkshire.and.The.Humber=Yorkshire.and.The.Humber,
  East.Midlands=East.Midlands,
  West.Midlands=West.Midlands,
  East=East,
  London=London,
  South.East=South.East,
  South.West=South.West,
  Wales=Wales,
  England=North.East+North.West+Yorkshire.and.The.Humber+East.Midlands+West.Midlands+East+London+South.East+South.West,
  Total.COVID.19.deaths.all.ages=Deaths.involving.COVID.19..all.ages1,
  Week.number=Week.number,
  Week.ended=Week.ended
)

write.table(df, file=paste0("./Covid_Registration.csv"), row.names=FALSE, sep=",")

c.date <- format(max(as.Date(data$Week.ended, origin = "1899-12-30")),"%d/%m/%Y")
s.date <- format(max(as.Date(data$Week.ended, origin = "1899-12-30")), "%d %B %Y")
# need to  calculate deaths in current week in England and Wales + Covid + excess 

deaths.england <- data %>% filter(Week.ended == max(data$Week.ended)) %>% summarise(England=North.East+North.West+Yorkshire.and.The.Humber+East.Midlands+West.Midlands+East+London+South.East+South.West)

deaths.england<-deaths.england[1,1]

#Function to extract all-cause, covid and excess deaths for a given name 

extract_row <- function(name){
  name.data = extract.week(name)
  name.data<-name.data[name.data$Week.ended>=as.Date("2020-03-01"),]
  current_week = c()
  for (x in rownames(name.data)){
    if (format(as.Date(name.data[x,1]), "%d/%m/%Y") == c.date){
      current_week <- x
    }
  }
  current_data <- name.data[current_week,]
  return(current_data)
}

extract_cumulative_row <- function(dataframe){
  latest_row <-dataframe[nrow(dataframe),]
  latest_row <- latest_row[,c('Week.ended','Covid','Deaths','50%','fit','97.5%','2.5%','region')]
}

string_condition_recent <- function(row, other_deaths, time){
  if ((other_deaths - as.numeric(row[,5]) > 0) & (other_deaths - as.numeric(row[,7]) > 0) & !(other_deaths - as.numeric(row[,6]) < 0)){
    string = sprintf('We would have expected %s (95%% CI %s – %s) all-cause deaths for that %s. This implies that total excess deaths were between %s – %s, and comprised of %s (95%% CI %s – %s) non-COVID-19 excess deaths.', 
                     as.character(round(row[,5])),
                     as.character(round(row[,7])),  
                     as.character(round(row[,6])),
                     time,
                     as.character(round(as.numeric(row[,3]) - as.numeric(row[,6]))),  
                     as.character(round(as.numeric(row[,3]) - as.numeric(row[,7]))), 
                     as.character(round(other_deaths - as.numeric(row[,5]))),
                     as.character(round(other_deaths - as.numeric(row[,6]))), 
                     as.character(round(other_deaths - as.numeric(row[,7]))))
    }
  else if ((other_deaths - as.numeric(row[,5]) > 0) & ( other_deaths - as.numeric(row[,7]) >= 0) & (other_deaths - as.numeric(row[,6]) <= 0)){
    string = sprintf('We would have expected %s (95%% CI %s – %s) all-cause deaths for that %s. This implies that total excess deaths were between %s – %s, and excess non-COVID-19 deaths were not significantly different than the expected deaths.',
                     as.character(round(row[,5])),
                     as.character(round(row[,7])),  
                     as.character(round(row[,6])),  
                     time,
                     as.character(round(as.numeric(row[,3]) - as.numeric(row[,6]))),  
                     as.character(round(as.numeric(row[,3]) - as.numeric(row[,7]))))
    }
  else if ((other_deaths - as.numeric(row[,5]) < 0) & (other_deaths - as.numeric(row[,7]) > 0) & !(other_deaths - as.numeric(row[,6]) < 0)){
    string = sprintf('There was a deficit of excess non-COVID-19 deaths in this %s of %s (95%% CI %s – %s), which means that non-COVID-19 deaths were significantly lower than the %s (95%% CI %s – %s) expected deaths for this %s.',
                    time,
                    as.character(round(other_deaths - as.numeric(row[,5]))),
                    as.character(round(other_deaths - as.numeric(row[,6]))),
                    as.character(round(other_deaths - as.numeric(row[,7]))),
                    as.character(round(row[,5])),
                    as.character(round(as.numeric(row[,7]))),
                    as.character(round(as.numeric(row[,6]))),
                    time)
    }
  else{
    string = ''
    }
  return(string)
}
```

\

Correspondence: [Katharina Hauck](mailto:k.hauck@imperial.ac.uk), [Neil Ferguson](mailto:n.ferguson@imperial.ac.uk)

\

### Introduction
\

This website provides weekly updates of deaths in England and Wales using publicly available data on the provisional number of deaths registered in the past week from the Office of National Statistics ([see Data](Data.html)). We show the number of registered all-cause deaths, and the deaths registered as COVID-19 deaths as provided by the ONS for every week beginning in March 2020. We compare the all-cause deaths with the number of deaths we would have expected to see being registered in this week had there been no pandemic, based on numbers of deaths in corresponding weeks of previous years, and determine the number of excess deaths as the difference. We then compare the excess deaths with the recorded COVID-19 deaths, which gives an estimate of excess deaths that were not associated with COVID-19 according to official registers. These estimates of excess non-COVID-19 deaths inform whether the pandemic led to unexpected deaths that were higher (or lower) than what we would have expected in that week ([Figure 1](figures.html)). It is possible that all or almost all excess deaths comprise of registered COVID-19 deaths, in that situation there are no excess non-COVID-19 deaths ([Figure 2](figures.html)). It is also possible that excess non-COVID-19 deaths are actually lower than expected deaths, once registered COVID-19 deaths are subtracted from excess deaths ([Figure 3](figures.html)). We also present total cumulative deaths across all categories. This is the sum of registered all-cause deaths, COVID-19 deaths, expected deaths and excess non-COVID-19 deaths from the week ending 6 March 2020 to `r s.date`. 
 
It is not straightforward to estimate expected deaths, because the number of deaths in the absence of the pandemic is inherently unobservable. We forecast the expected number of deaths in each week from March 2020 onwards using time series methods and data on deaths going back to 2010. We consider the uncertainty around our estimates using confidence intervals. For further details, see the [Methods section](Statistical_analysis.html).

\

### Possible interpretations of excess non-COVID-19 deaths

\

If excess non-COVID-19 deaths are higher than expected deaths: First, it is possible that deaths actually caused by COVID-19 are incorrectly attributed to other conditions. This could be due to lack of a diagnosis, nonspecific symptoms before death, multimorbidity making attribution of death difficult, lack of knowledge by the reporting medical staff, or stigma-related concerns of family members. Non-COVID-19 related deaths could be genuinely higher during the pandemic. First, the pandemic has caused disruption to healthcare provision. Hospitals have cancelled elective surgeries in some weeks, possibly resulting in increased mortality in those patients. Second, even critically ill patients may be reluctant to access care, for fear of hospital-acquired infections. Both inability and reluctance to access care may have led to patients’ death, when they would have survived in the absence of the pandemic. 

If excess non-COVID-19 deaths are lower than expected deaths: This finding could be due to irregularities in reporting. Second, the reduction in mobility and travel associated with control measures, particularly stay-at-home orders, may result in a reduction in accidents and associated deaths. Third, it is also possible that COVID-19 disease may cause mortality displacement, a short-term forward shift in mortality whereby a certain proportion of deaths due to COVID-19 occurred in patients that would have died of other conditions in the following weeks or months. This implies that over time, COVID-19 deaths that are higher than expected all-cause deaths are followed by lower than expected non-COVID-19 deaths in the following weeks and months, resulting in a deficit in excess non-COVID-19 deaths. In addition, hospitals have increased their capacity over time to treat non-COVID patients or patients changed their behaviour and started visiting hospitals again resulting in a reduction in deaths in line with expected levels.

Variations in deaths: The figures show steep increases and declines for COVID-19 deaths and unexplained deaths in some regions and for some ages over the weeks since March 2020. In some regions and weeks, excess non-COVID-19 deaths are even lower than expected deaths. These findings could have several explanations. First, case numbers vary over the pandemic, leading to variations in hospitalizations and deaths with a 2 to 3 weeks delay on average. Second, there may be irregularities in reporting. For example, in the first weeks of the pandemic, deaths due to COVID-19 may have been wrongly attributed to other conditions instead of COVID-19 but and in later weeks, non-COVID-19 deaths may have been wrongly attributed to COVID-19. 

\

### Limitations

\

The pandemic is ongoing, and we only estimate excess deaths until the week ending in `r s.date`. It is possible that the pandemic will impact on deaths in months and even years to come, including due to delays in cancer treatment resulting in treatable cancer becoming untreatable and causing death occurring months or years later. There is inherent uncertainty in forecasting deaths. We find that our model reliably predicts reported deaths in the pre-pandemic period between July 2019 and February 2020 based on data going back to 2010 ([Report 28](https://www.imperial.ac.uk/media/imperial-college/medicine/mrc-gida/2020-06-18-COVID19-Report-28.pdf)). However, there is no guarantee that a model that fits the pre-pandemic time period is forecasting well for the pandemic period that saw unprecedented changes in hospital care provision, patient behaviour, and many other factors including possibly the reporting of deaths itself. The uncertainty around our forecasts may take account of some but not all of this uncertainty. Moreover, we cannot take account of irregularities in the reporting of COVID-19 and non-COVID-19 deaths. For further limitations see ([Report 28](https://www.imperial.ac.uk/media/imperial-college/medicine/mrc-gida/2020-06-18-COVID19-Report-28.pdf)).

\

### Findings


\

### England: Deaths from week ending 06/03/2020 to week ending `r c.date`

\

```{r, echo=F, warnings = F, message=FALSE, fig.align = 'center'}
p.england<-producePlot("England")+theme(plot.title=element_text(size=12),axis.text=element_text(size=12))

png(filename = "England_update.png",
     width = 9, height = 6, units = "in", res = 300)
grid.arrange(p.england + theme(legend.position = "none"),
             ncol=1,
             bottom=g_legend(p.england + theme(legend.position="bottom",legend.text=element_text(size=10))))
dev.off() -> .

current_England <- extract_row("England")
England_all_cause <- current_England[,3]
England_covid <- current_England[,2]
England_other <- as.numeric(England_all_cause) - as.numeric(England_covid)

cumulative_England <- extract.cumulative("England")
England_cumulative_all_cause <- max(as.numeric(cumulative_England$Deaths))
England_cumulative_covid <- max(as.numeric(cumulative_England$Covid))
England_cumulative_other <- England_cumulative_all_cause - England_cumulative_covid
cumulative_England_latest <- extract_cumulative_row(cumulative_England)
```
![](./England_update.png) 

In the week ending `r s.date`, there were `r as.character(England_all_cause)` registered all-cause deaths in England. These comprise of `r as.character(England_covid)` deaths registered due to COVID-19 and `r as.character(England_other)` deaths registered due to other conditions. `r string_condition_recent(current_England, England_other, 'week')`

Over the weeks ending 6 March 2020 to `r s.date`, there were `r as.character(England_cumulative_all_cause)` cumulative registered all-cause deaths in England. These comprise of `r as.character(England_cumulative_covid)` deaths due to COVID-19 and `r as.character(England_cumulative_other)` deaths due to other conditions. `r string_condition_recent(cumulative_England_latest, England_cumulative_other, 'period')`

\

### England: Weekly deaths since 06/03/2020

\

```{r, echo=F, warnings = F, message=FALSE, fig.align = 'center'}

library(lubridate)

England_extract <- extract.week("England")
England_extract<-England_extract[England_extract$Week.ended>=ymd("2020-03-05"),]
England_extract$signal <- NULL

weeklyEngfull<-England_extract %>% 
  mutate(alldeaths = Deaths, 
         exptd = fit,
         per.expted=100*(fit)/(Deaths), 
         exptd.upr = (upr),
         per.expted.upr=100*(upr)/(Deaths),
         exptd.lwr = (lwr),
         per.expted.lwr=100*(lwr)/(Deaths),
         covid.num = (Covid),
         per.covid=100*(Covid)/(Deaths),
         exces.ncovid = (Deaths-Covid-fit),
         per.exces.ncovid=100*(Deaths-Covid-fit)/(Deaths),
         exces.ncovid.lwr = (Deaths-Covid-upr),
         per.exces.ncovid.lwr=100*(Deaths-Covid-upr)/(Deaths),
         exces.ncovid.upr = (Deaths-Covid-lwr),
         per.exces.ncovid.upr=100*(Deaths-Covid-lwr)/(Deaths)) %>%
  select(Week.ended, alldeaths, exptd, per.expted, exptd.upr,per.expted.upr,exptd.lwr,per.expted.lwr,covid.num, per.covid,exces.ncovid,per.exces.ncovid,exces.ncovid.lwr,per.exces.ncovid.lwr,exces.ncovid.upr,per.exces.ncovid.upr)

weeklyEngfull$alldeaths <- format(weeklyEngfull$alldeaths, big.mark=",", trim = TRUE)
weeklyEngfull$exptd <- paste(format(round(weeklyEngfull$exptd), 
                                    big.mark=",", trim = TRUE), " (", 
                             format(round(weeklyEngfull$per.expted, digits = 1),
                                    big.mark=",", trim = TRUE), "%)", sep = "")

weeklyEngfull$exptd_bounds <- paste(format(round(weeklyEngfull$exptd.lwr),
                                           big.mark=",", trim = TRUE), " - ", 
                            format(round(weeklyEngfull$exptd.upr), 
                                   big.mark=",", trim = TRUE), " (", 
                            round(weeklyEngfull$per.expted.lwr, digits = 1),"% - ", 
                            round(weeklyEngfull$per.expted.upr, digits = 1), "%)", 
                            sep = "")

weeklyEngfull$exces.ncovid <- paste(format(round(weeklyEngfull$exces.ncovid),
                                           big.mark=",", trim = TRUE), " (", 
                            round(weeklyEngfull$per.exces.ncovid, digits = 1), "%)",
                            sep = "")

weeklyEngfull$exces_bounds <- paste(format(round(weeklyEngfull$exces.ncovid.lwr),
                                           big.mark=",", trim = TRUE), " - ", 
                            format(round(weeklyEngfull$exces.ncovid.upr), 
                                   big.mark=",", trim = TRUE), " (", 
                            round(weeklyEngfull$per.exces.ncovid.lwr, digits = 1),
                            "% - ", 
                            round(weeklyEngfull$per.exces.ncovid.upr, digits = 1),
                            "%)", sep = "")

weeklyEngfull$covid.num <- paste(format(round(weeklyEngfull$covid.num), big.mark=",", trim = TRUE), " (", 
                         round(weeklyEngfull$per.covid, digits = 1), "%)", sep = "")
England_tab <- weeklyEngfull %>% select('Week.ended', 'alldeaths', 'exptd', 'exptd_bounds', 'covid.num', 'exces.ncovid', 'exces_bounds')
colnames(England_tab) <- c("Week ended", 
                           "Reported all-cause deaths", 
                           "Expected (%)",
                           "Expected 95% prediction interval (%)", 
                           "COVID-19 (%)",
                           "Excess non-COVID-19", 
                           "Excess non-COVID-19 95% prediction interval (%)")

kable(England_tab) %>%
  kable_styling(bootstrap_options = c("striped","condensed"),full_width = F, position = "left")

```

\

### English regions: Deaths from week ending 06/03/2020 to week ending `r c.date`

\

```{r, echo=F, warning=F, fig.height=12, fig.width = 12}
q<-theme(plot.title=element_text(size=16),axis.text=element_text(size=12),axis.title=element_text(size=14))

NorthWest<-producePlot("North.West")+q

NorthEast<-producePlot("North.East")+q

Yorkshire<-producePlot("Yorkshire.and.The.Humber")+q

WestMidlands<-producePlot("West.Midlands")+q

EastMidlands<-producePlot("East.Midlands")+q

East<-producePlot("East")+q

SouthWest<-producePlot("South.West")+q

London<-producePlot("London")+q

SouthEast<-producePlot("South.East")+q

png(filename = "EnglandRegions_update.png", width = 12, height = 9, units = "in", res = 300)
grid.arrange(NorthWest+ theme(legend.position = "none")+ggtitle("North West")+ylim(0, 3500),
             
             NorthEast+ theme(legend.position = "none")+ggtitle("North East")+ylim(0, 3500),
             
             Yorkshire + theme(legend.position = "none")+ ggtitle("Yorkshire and The Humber")+ylim(0, 3500),
             
             WestMidlands + theme(legend.position = "none")+ggtitle("West Midlands")+ylim(0, 3500), 
             
             EastMidlands + theme(legend.position = "none")+ggtitle("East Midlands")+ylim(0, 3500), 
             
             East + theme(legend.position ="none")+ggtitle("East")+ylim(0, 3500), 
             
             SouthWest + theme(legend.position = "none")+ggtitle("South West")+ylim(0, 3500), 
            
             London + theme(legend.position = "none")+ggtitle("London")+ylim(0, 3500),
            
            SouthEast + theme(legend.position = "none")+ggtitle("South East")+ylim(0, 3500), 
             ncol=3,
             bottom=g_legend(London + theme(legend.position="bottom",legend.text=element_text(size=18),legend.title=element_text(size=18))))
```
![](./EnglandRegions_update.png)

\

### Wales: Deaths from week ending 06/03/2020 to week ending `r c.date`

\

```{r, echo=F, warnings = F, message=FALSE, fig.align = 'center'}
p.wales<-producePlot("Wales")+theme(plot.title=element_text(size=12),axis.text=element_text(size=12))

png(filename = "Wales_update.png",
     width = 9, height = 6, units = "in", res = 300)
grid.arrange(p.wales + theme(legend.position = "none"),
             ncol=1,
             bottom=g_legend(p.england + theme(legend.position="bottom",legend.text=element_text(size=10))))
dev.off() -> .

current_Wales <- extract_row("Wales")
Wales_all_cause <- current_Wales[,3]
Wales_covid <- current_Wales[,2]
Wales_other <- as.numeric(Wales_all_cause) - as.numeric(Wales_covid)

cumulative_Wales <- extract.cumulative("Wales")
Wales_cumulative_all_cause <- max(as.numeric(cumulative_Wales$Deaths))
Wales_cumulative_covid <- max(as.numeric(cumulative_Wales$Covid))
Wales_cumulative_other <- Wales_cumulative_all_cause - Wales_cumulative_covid
cumulative_Wales_latest <- extract_cumulative_row(cumulative_Wales)
```
![](./Wales_update.png)


In the week ending `r s.date`, there were `r as.character(Wales_all_cause)` registered all-cause deaths in Wales. These comprise of `r as.character(Wales_covid)` deaths due to COVID-19 and `r as.character(Wales_other)` deaths due to other conditions. `r string_condition_recent(current_Wales, Wales_other, 'week')`

Over the weeks ending 6 March 2020 to `r s.date`, there were `r as.character(Wales_cumulative_all_cause)` cumulative registered all-cause deaths in Wales. These comprise of `r as.character(Wales_cumulative_covid)` deaths due to COVID-19 and `r as.character(Wales_cumulative_other)` deaths due to other conditions. `r string_condition_recent(cumulative_Wales_latest, Wales_cumulative_other, 'period')`

\

### England and Wales: Cumulative deaths from week ending 06/03/2020 to week ending `r c.date`

\

```{r, echo=F,  warning=FALSE, message=FALSE, results = 'asis' }
Regional_temp <- rbind(extract.cumulative("Yorkshire.and.The.Humber"),
                       extract.cumulative("North.East"),
                       extract.cumulative("North.West"),
                       extract.cumulative("East.Midlands"),
                       extract.cumulative("West.Midlands"),
                       extract.cumulative("East"),
                       extract.cumulative("London"),
                       extract.cumulative("South.West"),
                       extract.cumulative("South.East"),
                       extract.cumulative("England"),
                       extract.cumulative("Wales"))



Regional_temp<-Regional_temp[Regional_temp$Week.ended==as.Date(c.date,"%d/%m/%y"),]

Regional_temp$Week.ended<-NULL
Regional_temp$`50%`<-NULL
Regional_temp <- Regional_temp %>% dplyr::rename(lwr=`2.5%`,upr=`97.5%`)

Regional_temp<-Regional_temp %>% mutate(excess.Deaths.upr=Deaths-Covid-lwr, 
                                        excess.Deaths.lwr=Deaths-Covid-upr, 
                                        excess.Deaths.expected=Deaths-Covid-fit)

temp3<-Regional_temp %>% group_by(region) %>% summarise(
  allDeaths = Deaths,  
  exptd = fit, 
  per.expted=100*fit/Deaths,
  exptd.upr = upr,
  per.expted.upr=100*upr/Deaths,
  exptd.lwr = lwr,
  per.expted.lwr=100*lwr/Deaths,
  Covid.num = Covid,
  per.Covid=100*Covid/Deaths,
  exces.nCovid = Deaths-Covid-fit,
  per.exces.nCovid=100*(Deaths-Covid-fit)/Deaths,
  exces.nCovid.lwr = Deaths-Covid-upr,
  per.exces.nCovid.lwr=100*(Deaths-Covid-upr)/Deaths,
  exces.nCovid.upr = Deaths-Covid-lwr,
  per.exces.nCovid.upr=100*(Deaths-Covid-lwr)/Deaths)

temp3$allDeaths <- format(temp3$allDeaths, big.mark=",")

temp3$exptd <- paste0(format(round(temp3$exptd), big.mark=","), "\n(", 
                      format(round(temp3$per.expted, digits = 1), big.mark=","), "%)", 
                      sep = "")
temp3$exptd_bounds <- paste0(format(round(temp3$exptd.lwr), big.mark=","), " -", 
                             format(round(temp3$exptd.upr), big.mark=","), "\n(", 
                             round(temp3$per.expted.lwr, digits = 1),"% - ", 
                             round(temp3$per.expted.upr, digits = 1), "%)", sep = "")

temp3$exces.nCovid <- paste0(format(round(temp3$exces.nCovid), big.mark=","), "\n(", 
                             round(temp3$per.exces.nCovid, digits = 1), "%)", sep = "")
temp3$exces_bounds <- paste0(format(round(temp3$exces.nCovid.lwr), big.mark=","), " - ", 
                             format(round(temp3$exces.nCovid.upr), big.mark=","), "\n(", 
                             round(temp3$per.exces.nCovid.lwr, digits = 1),"% - ", 
                             round(temp3$per.exces.nCovid.upr, digits = 1), "%)", sep = "")

temp3$Covid.num <- paste0(format(round(temp3$Covid.num), big.mark=","), "\n(", 
                          round(temp3$per.Covid, digits = 1), "%)", sep = "")
temp3$region <- gsub("[.]"," ",temp3$region)
EW <- temp3[temp3$region %in% c("England", "Wales"),]
temp3 <- temp3[!temp3$region %in% c("England", "Wales"),]
temp3 <- rbind(temp3, EW)


regional_tab <- temp3 %>% select(region, allDeaths, exptd, exptd_bounds, Covid.num, exces.nCovid, exces_bounds)
colnames(regional_tab) <- c("Geographical unit", "Reported all-cause deaths", "Expected (%)", "Expected 95% confidence interval (%)", "COVID-19 (%)",
                            "Excess non-COVID-19 (%)", "Excess non-COVID-19 95% confidence interval (%)")
order<-c("England","North West","North East","Yorkshire and The Humber","West Midlands","East Midlands","East",
         "South West", "London","South East","Wales")

kable(regional_tab[match(order,regional_tab$`Geographical unit`),])%>%
  kable_styling(bootstrap_options = c("striped","condensed"),full_width = F, position = "left")
```

\

### England and Wales, older age groups: Deaths from week ending 06/03/2020 to week ending `r c.date`

\

```{r, echo=F, fig.height=12, fig.width=12}

q<-theme(plot.title=element_text(size=18),axis.text=element_text(size=12),axis.title=element_text(size=16))

p.all.85<-producePlot("All.85.")+q
p.F.85<-producePlot("Female.85.")+q
p.M.85<-producePlot("Male.85.")+q

p.All.75.84<-producePlot("All.75.84")+q
p.F.75.84<-producePlot("Female.75.84")+q
p.M.75.84<-producePlot("Male.75.84")+q


p.All.65.74<-producePlot("All.65.74")+q
p.F.65.74<-producePlot("Female.65.74")+q
p.M.65.74<-producePlot("Male.65.74")+q


p.All.45.64<-producePlot("All.75.84")+q
p.F.45.64<-producePlot("Female.75.84")+q
p.M.45.64<-producePlot("Male.75.84")+q

png(filename = "Olderage_update.png",
     width = 12, height = 9, units = "in", res = 300)
grid.arrange(p.all.85 + theme(legend.position = "none")+ggtitle("All 85+ yrs"), 
             p.F.85 + theme(legend.position = "none")+ggtitle("Female 85+ yrs"), 
             p.M.85 + theme(legend.position = "none")+ggtitle("Male 85+ yrs"), 
             p.All.75.84 + theme(legend.position = "none")+ggtitle("All 75-84 yrs"),
             p.F.75.84 + theme(legend.position = "none")+ggtitle("Female 75-84 yrs"),
             p.M.75.84 + theme(legend.position = "none")+ggtitle("Male 75-84 yrs"),
             p.All.65.74+ theme(legend.position = "none")+ggtitle("All 65-74 yrs"),
             p.F.65.74+ theme(legend.position = "none")+ggtitle("Female 65-74 yrs"),
             p.M.65.74+ theme(legend.position = "none")+ggtitle("Male 65-74 yrs"),
             p.All.45.64+ theme(legend.position = "none")+ggtitle("All 45-64 yrs"),
             p.F.45.64+ theme(legend.position = "none")+ggtitle("Female 45-64 yrs"),
             p.M.45.64+ theme(legend.position = "none")+ggtitle("Male 45-64 yrs"),
             ncol=3,
             bottom=g_legend(p.All.45.64 + theme(legend.position="bottom",legend.text=element_text(size=18),legend.title=element_text(size=18))))
```
![](./Olderage_update.png)

\

### England and Wales, older age groups: Cumulative deaths from week ending 06/03/2020 to week ending `r c.date`

\

```{r, echo=F,  warning=FALSE, message=FALSE, results = 'asis' }
Agegrp_temp <- rbind(extract.cumulative("All.85."),
                       extract.cumulative("Female.85."),
                       extract.cumulative("Male.85."),
                       extract.cumulative("All.75.84"),
                       extract.cumulative("Female.75.84"),
                       extract.cumulative("Male.75.84"),
                       extract.cumulative("All.65.74"),
                       extract.cumulative("Female.65.74"),
                       extract.cumulative("Male.65.74"),
                       extract.cumulative("All.45.64"),
                       extract.cumulative("Female.45.64"),
                       extract.cumulative("Male.45.64"))

Agegrp_temp<-Agegrp_temp[Agegrp_temp$Week.ended==as.Date(c.date,"%d/%m/%y"),]

Agegrp_temp$Week.ended<-NULL
Agegrp_temp$`50%`<-NULL
Agegrp_temp <- Agegrp_temp %>% dplyr::rename(lwr=`2.5%`,upr=`97.5%`)

Agegrp_temp<-Agegrp_temp %>% mutate(excess.Deaths.upr=Deaths-Covid-lwr, 
                                        excess.Deaths.lwr=Deaths-Covid-upr, 
                                        excess.Deaths.expected=Deaths-Covid-fit)

temp4<-Agegrp_temp %>% group_by(region) %>% summarise(
  allDeaths = Deaths,  
  exptd = fit, 
  per.expted=100*fit/Deaths,
  exptd.upr = upr,
  per.expted.upr=100*upr/Deaths,
  exptd.lwr = lwr,
  per.expted.lwr=100*lwr/Deaths,
  Covid.num = Covid,
  per.Covid=100*Covid/Deaths,
  exces.nCovid = Deaths-Covid-fit,
  per.exces.nCovid=100*(Deaths-Covid-fit)/Deaths,
  exces.nCovid.lwr = Deaths-Covid-upr,
  per.exces.nCovid.lwr=100*(Deaths-Covid-upr)/Deaths,
  exces.nCovid.upr = Deaths-Covid-lwr,
  per.exces.nCovid.upr=100*(Deaths-Covid-lwr)/Deaths)

temp4$allDeaths <- format(temp4$allDeaths, big.mark=",")

temp4$exptd <- paste0(format(round(temp4$exptd), big.mark=","), "\n(", 
                      format(round(temp4$per.expted, digits = 1), big.mark=","), "%)", 
                      sep = "")
temp4$exptd_bounds <- paste0(format(round(temp4$exptd.lwr), big.mark=","), " - ", 
                             format(round(temp4$exptd.upr), big.mark=","), "\n(", 
                             round(temp4$per.expted.lwr, digits = 1),"% - ", 
                             round(temp4$per.expted.upr, digits = 1), "%)", sep = "")

temp4$exces.nCovid <- paste0(format(round(temp4$exces.nCovid), big.mark=","), "\n(", 
                             round(temp4$per.exces.nCovid, digits = 1), "%)", sep = "")
temp4$exces_bounds <- paste0(format(round(temp4$exces.nCovid.lwr), big.mark=","), " - ", 
                             format(round(temp4$exces.nCovid.upr), big.mark=","), "\n(", 
                             round(temp4$per.exces.nCovid.lwr, digits = 1),"% - ", 
                             round(temp4$per.exces.nCovid.upr, digits = 1), "%)", sep = "")

temp4$Covid.num <- paste0(format(round(temp4$Covid.num), big.mark=","), "\n(", 
                          round(temp4$per.Covid, digits = 1), "%)", sep = "")
temp4$region <- gsub("[.]"," ",temp4$region)
temp4$region <- gsub("All", "All:", temp4$region)
temp4$region <- gsub("Female", "Female:", temp4$region)
temp4$region <- gsub("Male", "Male:", temp4$region)
temp4$region <- gsub("45 64", "45-64", temp4$region)
temp4$region <- gsub("65 74", "65-74", temp4$region)
temp4$region <- gsub("75 84", "75-84", temp4$region)
temp4$region <- gsub("85 ", "85+", temp4$region)

agegrp_tab <- temp4 %>% select(region, allDeaths, exptd, exptd_bounds, Covid.num, exces.nCovid, exces_bounds)
colnames(agegrp_tab) <- c("Sex and age group (years)", "Reported all-cause deaths", "Expected (%)", "Expected 95% confidence interval (%)", "COVID-19 (%)",
                            "Excess non-COVID-19 (%)", "Excess non-COVID-19 95% confidence interval (%)")


kable(agegrp_tab) %>%
  kable_styling(bootstrap_options = c("striped","condensed"),full_width = F, position = "left")
```
\

### England and Wales, younger age groups: Deaths from week ending 06/03/2020 to week ending `r c.date`

\

```{r, echo=F, fig.height=9, fig.width=12}

q<-theme(plot.title=element_text(size=19),axis.text=element_text(size=12),axis.title=element_text(size=16))


p.All.15.44<-producePlot("All.15.44")+q
p.F.15.44<-producePlot("Female.15.44")+q
p.M.15.44<-producePlot("Male.15.44")+q


p.All.1.14<-producePlot("All.01.14")+q
p.F.1.14<-producePlot("Female.01.14")+q
p.M.1.14<-producePlot("Male.01.14")+q


p.All.0.1<-producePlot("All.Under.1.year")+q
p.F.0.1<-producePlot("Female.Under.1.year")+q
p.M.0.1<-producePlot("Male.Under.1.year")+q

png(filename = "Youngerage_update.png",
     width = 12, height = 9, units = "in", res = 300)
grid.arrange(
             p.All.15.44 + theme(legend.position = "none")+ggtitle("All 15-44 yrs"),
             p.F.15.44 + theme(legend.position = "none")+ggtitle("Female 15-44 yrs"),
             p.M.15.44 + theme(legend.position = "none")+ggtitle("Male 15-44 yrs"),
             p.All.1.14+ theme(legend.position = "none")+ggtitle("All 1-14 yrs"),
             p.F.1.14+ theme(legend.position = "none")+ggtitle("Female 1-14 yrs"),
             p.M.1.14+ theme(legend.position = "none")+ggtitle("Male 1-14 yrs"),
             p.All.0.1+ theme(legend.position = "none")+ggtitle("All <1 yrs"),
             p.F.0.1+ theme(legend.position = "none")+ggtitle("Female <1 yrs"),
             p.M.0.1+ theme(legend.position = "none")+ggtitle("Male <1 yrs"),
             ncol=3,
             bottom=g_legend(p.All.45.64 + theme(legend.position="bottom",legend.text=element_text(size=18),legend.title=element_text(size=18))))
```
![](Youngerage_update.png)

Website updated on `r format(Sys.Date(), "%d/%m/%Y")`.

